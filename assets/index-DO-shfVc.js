import{w as b}from"./with-props-C8iTRjLV.js";import{j as i}from"./jsx-runtime-BjG_zV1W.js";import{r as o,O as k}from"./chunk-DQRVZFIR-xr6Eq5NQ.js";import{M as S,L as j,a as M,U as P}from"./data-BYKLtqdt.js";import{u as w}from"./LanguageContext-Z0JNIAJS.js";import{a as m}from"./notifications.store-DKJnsAow.js";import"./random-id-CQPYUG5g.js";const E={farewellBackground:!0},R=o.createContext({...E,enable:()=>{},disable:()=>{},toggle:()=>{}}),A=({children:e})=>{const[t,r]=o.useState(E),d=n=>r(a=>({...a,[n]:!0})),s=n=>r(a=>({...a,[n]:!1})),c=n=>r(a=>({...a,[n]:!a[n]}));return i.jsx(R.Provider,{value:{...t,enable:d,disable:s,toggle:c},children:e})},g=(e,t)=>typeof e=="object"&&e!==null?{x:e.x||0,y:e.y||0}:{x:e||0,y:t||0};g(0,0);g(1,1);function L(e){return new Worker("/assets/effects.worker-D-fIn7q9.js",{name:e==null?void 0:e.name})}const z=e=>t=>t[e.type]?t[e.type](e.data):t._(),I=({onDimensionsChange:e,onInitialized:t})=>{const r=o.useRef(null),d=o.useRef(null),s=()=>{const n=Math.min(window.devicePixelRatio,1);return{x:window.innerWidth*n*1,y:window.innerHeight*n*1}};return o.useEffect(()=>{if(!r.current)return;const n=r.current.transferControlToOffscreen(),a=new L;return d.current=a,a.postMessage({type:"init",data:{canvas:n,dimensions:s()}},[n]),a.onmessage=p=>{const x=p.data;z(x)({initialized:()=>{console.log("Effects worker initalized")}})},()=>{a.terminate(),d.current=null}},[]),w("mousemove",c=>{var a;const n=g(c.clientX,c.clientY);(a=d.current)==null||a.postMessage({type:"mousemove",data:{pos:n}})}),w("resize",()=>{var n;if(!r.current)return;const c=s();(n=d.current)==null||n.postMessage({type:"dimensionsChange",data:{dimensions:c}})}),w("scroll",()=>{var c;r.current&&((c=d.current)==null||c.postMessage({type:"scroll",data:{pos:g(0,window.scrollY)}}))},{capture:!0}),{ref:r}},D=()=>{const{ref:e}=I({});return i.jsxs("div",{className:"pageBackground",children:[i.jsx("div",{id:"rr1",style:{position:"absolute",left:0,bottom:0}}),i.jsx("div",{id:"rr2",style:{position:"absolute",right:0,bottom:0}}),i.jsx("canvas",{className:"pageBackground",style:{width:"100vw",height:"100vh",imageRendering:"pixelated"},ref:e})]})},O=({children:e})=>{const t=o.useRef(null),r=o.useRef(null),d=o.useRef(null),[s,c]=o.useState(null),[n,a]=o.useState(!1),[p,x]=o.useState(!1);o.useEffect(()=>{let u=new Audio;return t.current=u,()=>{var l;(l=r.current)==null||l.close(),u.pause(),u.remove(),t.current=null}},[]),o.useEffect(()=>{if(!t.current)return;const u=new AbortController,{signal:l}=u;return t.current.addEventListener("playing",()=>{m.hide("music-error")},{signal:l}),()=>u.abort()},[]),o.useEffect(()=>{if(!t.current)return;const u=new AbortController,{signal:l}=u;return t.current.addEventListener("ended",()=>{if(!s)return;const f=S;let v=f.indexOf(s);if(v==-1)return;let y=v+1;y>=f.length&&(y=0);let C=f[y];C&&c(C)},{signal:l}),()=>u.abort()},[s]),o.useEffect(()=>{if(s)return m.show({id:"music-nowplaying",title:i.jsx(j,{en:"Now Playing",tr:"Şimdi Çalıyor"}),message:s.title}),()=>void m.hide("music-nowplaying");m.hide("music-nowplaying")},[s]);const h=()=>{var u;(u=t.current)==null||u.play().then(()=>{r.current=new AudioContext;let l=r.current.createMediaElementSource(t.current);d.current=r.current.createAnalyser(),l.connect(d.current),l.connect(r.current.destination)}).catch(l=>{if(l instanceof DOMException&&l.name=="NotAllowedError"){m.show({id:"music-error",message:i.jsx(j,{en:"Can't play music, please click anywhere",tr:"Müzik çalınamıyor, herhangi bir yere tıklayın"}),autoClose:!1,position:"top-center",color:"yellow"});const f=()=>h();window.addEventListener("click",f,{once:!0})}})};return o.useEffect(()=>{t.current&&(t.current.pause(),t.current.src=s?`/assets/music/${s.file}`:"",s&&h())},[s]),i.jsx(M.Provider,{value:{ref:t,loading:n,playing:p,currentSong:s,analyser:d,audioContext:r,changeCurrentSong:c},children:e})},Y=b(function(){return i.jsx(A,{children:i.jsx(P,{children:i.jsxs(O,{children:[i.jsx(D,{}),i.jsx(k,{})]})})})});export{Y as default};
