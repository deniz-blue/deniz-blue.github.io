import{a,w as W,O as F}from"./chunk-C37GKA54-CfDO-w_Y.js";import{j as s}from"./jsx-runtime-D_zvdyIk.js";import{u as B,v as j,a as H,b as z,L as R,S as U,B as J,W as Z,F as Y,A as V,U as X,c as q}from"./AppContext-CVKXTMyd.js";import{a as w}from"./LanguageContext-BwzRQnqe.js";import{a as E}from"./notifications.store-DFt6vRHl.js";const K="/assets/IMAGE_DEPTH_4-O8gd5XC3.png",Q="/assets/AUDIO_ANOTHERHIM-D8FEBsaZ.ogg",$=(e,r)=>{const t=a.useRef(e);t.current=e,a.useEffect(()=>{let i=performance.now();const n=()=>{performance.now()-i>=r&&(t.current(),i=performance.now()),d=requestAnimationFrame(n)};let d=requestAnimationFrame(n);return()=>{cancelAnimationFrame(d)}},[])},M=(e,r={})=>{const t=a.useRef(null),i=a.useRef(null),n=a.useRef(null);a.useEffect(()=>{const o=t.current;if(!o)return;o.width=r.size?.x||o.clientWidth,o.height=r.size?.y||o.clientHeight;const l=o.getContext("2d",{alpha:!0,desynchronized:!0});return l?(i.current=l,n.current=e(l),()=>{n.current?.destroy?.(),i.current=null}):r?.onFail?.()},[e,t]);const d=a.useCallback(()=>{n.current?.update?.(1),i.current&&i.current.clearRect(0,0,i.current.canvas.width,i.current.canvas.height),n.current?.draw()},[r.noClear]);$(d,30);const h=a.useCallback(()=>{t.current&&(t.current.width=r.size?.x||t.current.clientWidth,t.current.height=r.size?.y||t.current.clientHeight)},[t,r.size]);return w("resize",h),{ref:t}},O=()=>{const e=a.useRef(null),r=a.useCallback(()=>{e.current?.play().catch(()=>{})},[e]);return w("click",r,{once:!0}),e};class ee{siner;alpha;xstretch;ystretch;o_insurance;depth;b_insurance;OBSPEED;constructor(){this.siner=0,this.alpha=.2,this.xstretch=1,this.ystretch=1,this.o_insurance=0,this.depth=4,this.OBSPEED=.02,this.b_insurance=-.2}destroy(){}step(){this.siner+=1,this.OBSPEED>0&&(this.alpha=Math.sin(this.siner/34)*.2),this.ystretch+=this.OBSPEED,this.xstretch+=this.OBSPEED,this.b_insurance<0&&(this.b_insurance+=.01),this.ystretch>2&&(this.o_insurance+=.01,this.o_insurance>=.5&&this.destroy())}shouldDraw(){return this.siner<150&&this.siner>2}getAlpha(){return Math.max(0,.2+this.alpha-this.o_insurance+this.b_insurance)}}const te=()=>{B("ARE WE CONNECTED?");const e=a.useCallback(i=>{let n=[],d=new Image;d.src=K;let h=0,o=0,l=.5;return{update(){if(h+=1,o+=l,o>=20){let u=new ee;u.depth=5+h,u.OBSPEED=.01*l,u.destroy=()=>n=n.filter(f=>f!==u),n.unshift(u),h>=6e4&&(h=0),o=0}for(let u of n)u.step()},draw(){if(d.complete)for(let u of n){if(!u.shouldDraw())continue;let f=u.getAlpha();i.globalAlpha=f;const c=d.width*u.xstretch,g=d.height*u.ystretch;i.drawImage(d,160-c/2,120-g/2,c,g)}}}},[]),{ref:r}=M(e,{size:j(320,240)}),t=O();return s.jsxs("div",{className:"pageBackground",children:[s.jsx("canvas",{className:"pageBackground",style:{objectFit:"cover",imageRendering:"crisp-edges"},ref:r}),s.jsx("audio",{src:Q,ref:t,autoPlay:!0,loop:!0})]})},ne="/assets/tree-DOnJeJ13.gif",re="/assets/man-DVTDGMKe.ogg",se=()=>{const e=O();return B("* "),s.jsxs("div",{className:"pageBackground",children:[s.jsx("div",{className:"fullscreen",style:{backgroundImage:`url("${ne}")`,backgroundPosition:"center center",backgroundRepeat:"no-repeat"}}),s.jsx("audio",{src:re,loop:!0,autoPlay:!0,ref:e})]})},ae=()=>{const{myBurdenIsDead:e}=H(),[r]=a.useState(()=>[1,-1].map(t=>Array(128).fill(0).map((i,n)=>{const d=Math.floor(Math.random()*4)*5;return{key:t*(n+1),color:t>0?"#97257a":"#7463aa",size:d,top:Math.random()/2*100+(t==1?80:0)-20+"%",left:Math.random()*100+"%"}})).flat());return s.jsxs("div",{className:"pageBackground",style:{backgroundImage:"linear-gradient(#250630, #63173d)",height:"100vh"},children:[r.map(({key:t,size:i,color:n,top:d,left:h})=>s.jsx("div",{style:{backgroundColor:n,opacity:.7,width:i,height:i,position:"absolute",top:d,left:h}},t)),s.jsx("img",{src:"/assets/img/detail/oneshot/NikoPromoTransparent.png",style:{position:"absolute",bottom:"calc(-60px)",maxHeight:"200px",maxWidth:"70vw",marginLeft:"1rem"}}),s.jsx("div",{className:"pageBackground",style:{opacity:e?1:0,backgroundColor:"black",zIndex:2},children:s.jsx("img",{src:"/assets/img/detail/oneshot/NikoDead.png",style:{position:"absolute",bottom:"0px",maxHeight:"200px",maxWidth:"80vw",marginLeft:"1rem"}})})]})},oe=()=>{let e=49734321;return()=>(e=e+2127912214+(e<<12)&4294967295,e=(e^3345072700^e>>>19)&4294967295,e=e+374761393+(e<<5)&4294967295,e=(e+3550635116^e<<9)&4294967295,e=e+4251993797+(e<<3)&4294967295,e=(e^3042594569^e>>>16)&4294967295,(e&268435455)/268435456)},ie=()=>{const e=a.useCallback(t=>{t.lineWidth=1,t.imageSmoothingEnabled=!1;const i=(o,l,u,f,c,g)=>{t.fillStyle=c,t.fillRect(o,l,u,f),g&&(t.strokeStyle=g,t.strokeRect(o+.5,l+.5,u,f))},n=(o,l,u,f,c,g,m,A,p,k)=>{for(let x=0;x<c;x++)for(let C=0;C<g;C++)i(o+(u+m)*x,l+(f+A)*C,u,f,p,k)},d=(o,l,u,f)=>{t.save(),t.globalAlpha=.5;let c=t.createRadialGradient(o,l,0,o,l,f);c.addColorStop(0,u+"ff"),c.addColorStop(1,u+"00"),t.beginPath(),t.fillStyle=c,t.arc(o,l,f,0,Math.PI*2,!1),t.fill(),t.restore()},h=({x:o,y:l,fw:u,h:f,sw:c,wh:g,ww:m,wax:A,way:p,hl:k})=>{const x="#5A0D36",C="#6E1244",P="#290427",D="#4B092E",N="#2A0428",T="#B1184B",_="#1E021F",S="#FF59BE";i(o+u-1,l,c,f,P,D),i(o,l,u,f,x,C),n(o+4,l+12,m,g,A,p,5,5,N),n(o+4,l+12+g,m,1,A,p,5,5+g-1,T),n(o+u+3,l+12,4,g,3,p,3,5,_);for(let v of k){let y=v%A*(m+5),b=Math.floor(v/p)*(g+5),G=o+4+y+m/2,L=l+12+b+g/2;d(G,L,S,15)}for(let v of k){let y=v%A*(m+5),b=Math.floor(v/p)*(g+5);i(o+4+y,l+12+b,m,g,S)}};return{draw(){t.lineJoin="miter",t.lineCap="square",t.strokeStyle="blue";let o=oe(),l=[...new Set(Array(5).fill(0).map(()=>Math.floor(o()*25)))];h({x:50,y:50,fw:70,sw:25,h:200,ww:8,wh:9,wax:5,way:5,hl:l})}}},[]),{ref:r}=M(e);return s.jsx("div",{className:"pageBackground",children:s.jsx("canvas",{className:"pageBackground",style:{imageRendering:"crisp-edges"},ref:r})})},I=j(320,180),ce=a.memo(()=>{const[e,r]=a.useState(!1);return a.useEffect(()=>{const t=requestAnimationFrame(()=>r(!0));return()=>cancelAnimationFrame(t)},[]),s.jsx("div",{className:"pageBackground",style:{backgroundImage:"url('/assets/img/detail/sky.png')",backgroundRepeat:"repeat",backgroundAttachment:"fixed"},children:e&&s.jsx(le,{})})}),le=()=>{const e=a.useRef(null),r=a.useRef(null);return a.useRef(null),a.useEffect(()=>{let t=!1;const i=requestAnimationFrame(()=>{if(t)return;const n=e.current;if(!n)return;n.width=n.clientWidth,n.height=n.clientHeight;const d=n.transferControlToOffscreen(),h=new Worker(new URL("/assets/effects.worker-Rp4pQ9-p.js",import.meta.url),{type:"module"});h.postMessage({type:"init",data:d},[d]),r.current=h});return()=>{cancelAnimationFrame(i),r.current?.terminate(),r.current=null,t=!0}},[]),w("resize",()=>{const t=e.current;t&&r.current?.postMessage({type:"dimensionsChange",data:j(t.clientWidth,t.clientHeight)})}),s.jsx("canvas",{ref:e,className:"pageBackground",style:{objectFit:"contain",aspectRatio:I.x/I.y,imageRendering:"pixelated"}})},ue=()=>{const[{type:e}]=z();return s.jsxs("div",{style:{position:"fixed",zIndex:-1},children:[e==="starfield"&&s.jsx(ce,{},Date.now()),e==="oneshot"&&s.jsx(ae,{}),e==="depth"&&s.jsx(te,{}),e==="man"&&s.jsx(se,{}),e==="refuge"&&s.jsx(ie,{})]})},de=a.createContext({ref:{current:null},analyser:{current:null},audioContext:{current:null},currentSong:null,loading:!0,playing:!1,changeCurrentSong:()=>{}}),ge=[{title:"Fear of the Unknown",artist:"Lena Raine",cover:"celestefarewell.jpg",file:"Fear of the Unknown.mp3"},{title:"world.execute(me);",artist:"Mili",cover:"miraclemilk.jpg",file:"worldexecuteme.m4a"},{title:"Confessions of a Rotten Girl",artist:"SAWTOWNE",cover:"ConfessionsOfARottenGirl.png",file:"ConfessionsOfARottenGirl.mp3"},{title:"Medicine",romanji:"Igaku",artist:"Sasuke Haraguchi",originalTitle:"イガク",cover:"igaku.png",file:"igaku.mp3"},{title:"Flower of Transformation",romanji:"Bake no Hana",originalTitle:"化けの花",artist:"NAKISO",cover:"mizu5.png",file:"bakenohana.mp3"},{title:"Substitute",romanji:"Hitogawari",originalTitle:"ヒトガワリ",artist:"KikuoHana",file:"hitogawari.mp3",cover:"kikuohana2.png"},{title:"Take Me To The Beach (feat. Ado)",file:"TakeMeToTheBeach.mp3",cover:"TakeMeToTheBeach.png",artist:"Imagine Dragons"},{title:"A Fool Moon Night",artist:"THE KOXX",cover:"thekoxx.png",file:"afoolmoonnight.mp3"}],fe=({children:e})=>{const r=a.useRef(null),t=a.useRef(null),i=a.useRef(null),[n,d]=a.useState(null),[h,o]=a.useState(!1),[l,u]=a.useState(!1);a.useEffect(()=>{let c=new Audio;return r.current=c,()=>{t.current?.close(),c.pause(),c.remove(),r.current=null}},[]),a.useEffect(()=>{if(!r.current)return;const c=new AbortController,{signal:g}=c;return r.current.addEventListener("playing",()=>{E.hide("music-error")},{signal:g}),()=>c.abort()},[]),a.useEffect(()=>{if(!r.current)return;const c=new AbortController,{signal:g}=c;return r.current.addEventListener("ended",()=>{if(!n)return;const m=ge;let A=m.indexOf(n);if(A==-1)return;let p=A+1;p>=m.length&&(p=0);let k=m[p];k&&d(k)},{signal:g}),()=>c.abort()},[n]),a.useEffect(()=>{if(n)return E.show({id:"music-nowplaying",title:s.jsx(R,{en:"Now Playing",tr:"Şimdi Çalıyor"}),message:n.title}),()=>void E.hide("music-nowplaying");E.hide("music-nowplaying")},[n]);const f=()=>{r.current?.play().then(()=>{t.current=new AudioContext;let c=t.current.createMediaElementSource(r.current);i.current=t.current.createAnalyser(),c.connect(i.current),c.connect(t.current.destination)}).catch(c=>{if(c instanceof DOMException&&c.name=="NotAllowedError"){E.show({id:"music-error",message:s.jsx(R,{en:"Can't play music, please click anywhere",tr:"Müzik çalınamıyor, herhangi bir yere tıklayın"}),autoClose:!1,position:"top-center",color:"yellow"});const g=()=>f();window.addEventListener("click",g,{once:!0})}})};return a.useEffect(()=>{r.current&&(r.current.pause(),r.current.src=n?`/assets/music/${n.file}`:"",n&&f())},[n]),s.jsx(de.Provider,{value:{ref:r,loading:h,playing:l,currentSong:n,analyser:i,audioContext:t,changeCurrentSong:d},children:e})},he="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAALRJREFUOBHtk0sSgCAMQ8Hx/ldWBFNDqfxGdrrpN4/IqHOLHv/CPag/tWOJGAq+3mvumAJW0QLSOG7sOCxfzgrBpN3IBPgVquHsFDNEwELtNzS/jnsvsObUYixz/IPlupddBX166Qe5jhz9AhgS5LFkx2oubzWSCEMSUothSWjIqRJnJTuGJltAsxELTdEggBiW5B4qkSrTkuUYbFOAoX3GM+0Ra8NQV7XVIQghanivjhAfpSe9CxcmJTWuYwAAAABJRU5ErkJggg==",me=()=>{const{ref:e}=a.useContext(U);return s.jsx("div",{className:"fullscreen",style:{zIndex:-1,position:"absolute",width:"100%",height:"100%",overflow:"visible"},children:s.jsx("div",{id:"SOUL",style:{width:22,height:22,backgroundImage:`url("${he}")`,transform:"translate(-100px, -100px)",transition:"transform 100ms"},ref:e})})},pe=({providers:e,children:r})=>s.jsx(s.Fragment,{children:e.reduceRight((t,i)=>s.jsx(i,{children:t}),r)}),Ee=W(function(){return s.jsxs(pe,{providers:[J,Z,Y,V,X,fe,q],children:[s.jsx(ue,{}),s.jsx(me,{}),s.jsx(F,{})]})});export{Ee as default};
