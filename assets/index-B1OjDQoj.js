import{r as o,w as j,O as S}from"./chunk-NL6KNZEE-CmXXYeEG.js";import{j as d}from"./jsx-runtime-BjG_zV1W.js";import{M as b,L as E,a as M,U as P}from"./data-4jxzbBml.js";import{u as y}from"./use-window-event-BOHwcSv9.js";import"./LanguageContext-s3Rp6igO.js";import{a as m}from"./notifications.store-DrnWNSCY.js";import"./random-id-CQPYUG5g.js";const k={farewellBackground:!0},R=o.createContext({...k,enable:()=>{},disable:()=>{},toggle:()=>{}}),A=({children:e})=>{const[t,r]=o.useState(k),l=n=>r(c=>({...c,[n]:!0})),s=n=>r(c=>({...c,[n]:!1})),a=n=>r(c=>({...c,[n]:!c[n]}));return d.jsx(R.Provider,{value:{...t,enable:l,disable:s,toggle:a},children:e})},g=(e,t)=>typeof e=="object"&&e!==null?{x:e.x||0,y:e.y||0}:{x:e||0,y:t||0};g(0,0);g(1,1);function L(e){return new Worker("/assets/effects.worker-BxYSl4vk.js",{name:e==null?void 0:e.name})}const z=e=>t=>t[e.type]?t[e.type](e.data):t._(),B=({onDimensionsChange:e,onInitialized:t})=>{const r=o.useRef(null),l=o.useRef(null),s=()=>{const n=Math.min(window.devicePixelRatio,1);return{x:window.innerWidth*n*1,y:window.innerHeight*n*1}};return o.useEffect(()=>{if(!r.current)return;const n=r.current.transferControlToOffscreen(),c=new L;return l.current=c,c.postMessage({type:"init",data:{canvas:n,dimensions:s()}},[n]),c.onmessage=p=>{const x=p.data;z(x)({initialized:()=>{console.log("Effects worker initalized")}})},()=>{c.terminate(),l.current=null}},[]),y("mousemove",a=>{var c;const n=g(a.clientX,a.clientY);(c=l.current)==null||c.postMessage({type:"mousemove",data:{pos:n}})}),y("resize",()=>{var n;if(!r.current)return;const a=s();(n=l.current)==null||n.postMessage({type:"dimensionsChange",data:{dimensions:a}})}),y("scroll",()=>{var a;r.current&&((a=l.current)==null||a.postMessage({type:"scroll",data:{pos:g(0,window.scrollY)}}))},{capture:!0}),{ref:r}},I=()=>{const{ref:e}=B({});return d.jsx("div",{className:"pageBackground",children:d.jsx("canvas",{className:"pageBackground",style:{width:"100vw",height:"100vh",imageRendering:"pixelated"},ref:e})})},O=({children:e})=>{const t=o.useRef(null),r=o.useRef(null),l=o.useRef(null),[s,a]=o.useState(null),[n,c]=o.useState(!1),[p,x]=o.useState(!1);o.useEffect(()=>{let i=new Audio;return t.current=i,()=>{var u;(u=r.current)==null||u.close(),i.pause(),i.remove(),t.current=null}},[]),o.useEffect(()=>{if(!t.current)return;const i=new AbortController,{signal:u}=i;return t.current.addEventListener("playing",()=>{m.hide("music-error")},{signal:u}),()=>i.abort()},[]),o.useEffect(()=>{if(!t.current)return;const i=new AbortController,{signal:u}=i;return t.current.addEventListener("ended",()=>{if(!s)return;const f=b;let v=f.indexOf(s);if(v==-1)return;let w=v+1;w>=f.length&&(w=0);let C=f[w];C&&a(C)},{signal:u}),()=>i.abort()},[s]),o.useEffect(()=>{if(s)return m.show({id:"music-nowplaying",title:d.jsx(E,{en:"Now Playing",tr:"Şimdi Çalıyor"}),message:s.title}),()=>void m.hide("music-nowplaying");m.hide("music-nowplaying")},[s]);const h=()=>{var i;(i=t.current)==null||i.play().then(()=>{r.current=new AudioContext;let u=r.current.createMediaElementSource(t.current);l.current=r.current.createAnalyser(),u.connect(l.current),u.connect(r.current.destination)}).catch(u=>{if(u instanceof DOMException&&u.name=="NotAllowedError"){m.show({id:"music-error",message:d.jsx(E,{en:"Can't play music, please click anywhere",tr:"Müzik çalınamıyor, herhangi bir yere tıklayın"}),autoClose:!1,position:"top-center",color:"yellow"});const f=()=>h();window.addEventListener("click",f,{once:!0})}})};return o.useEffect(()=>{t.current&&(t.current.pause(),t.current.src=s?`/assets/music/${s.file}`:"",s&&h())},[s]),d.jsx(M.Provider,{value:{ref:t,loading:n,playing:p,currentSong:s,analyser:l,audioContext:r,changeCurrentSong:a},children:e})},$=j(function(){return d.jsx(A,{children:d.jsx(P,{children:d.jsxs(O,{children:[d.jsx(I,{}),d.jsx(S,{})]})})})});export{$ as default};
