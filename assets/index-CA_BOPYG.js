import{a as s,w as j,O as I}from"./chunk-C37GKA54-CfDO-w_Y.js";import{j as a}from"./jsx-runtime-D_zvdyIk.js";import{u as E,v as x,a as S,b as R,L as y,S as B,B as M,W as O,F as P,A as D,U as T,c as N}from"./AppContext-Dvg-KlC2.js";import{a as k}from"./LanguageContext-BwzRQnqe.js";import{a as m}from"./notifications.store-DFt6vRHl.js";const G="/assets/IMAGE_DEPTH_4-O8gd5XC3.png",L="/assets/AUDIO_ANOTHERHIM-D8FEBsaZ.ogg",W=(r,t)=>{const e=s.useRef(r);e.current=r,s.useEffect(()=>{let o=performance.now();const n=()=>{performance.now()-o>=t&&(e.current(),o=performance.now()),i=requestAnimationFrame(n)};let i=requestAnimationFrame(n);return()=>{cancelAnimationFrame(i)}},[])},F=(r,t={})=>{const e=s.useRef(null),o=s.useRef(null),n=s.useRef(null);s.useEffect(()=>{const d=e.current;if(!d)return;d.width=t.size?.x||d.clientWidth,d.height=t.size?.y||d.clientHeight;const g=d.getContext("2d",{alpha:!0,desynchronized:!0});return g?(o.current=g,n.current=r(g),()=>{n.current?.destroy?.(),o.current=null}):t?.onFail?.()},[r,e]);const i=s.useCallback(()=>{n.current?.update?.(1),o.current&&o.current.clearRect(0,0,o.current.canvas.width,o.current.canvas.height),n.current?.draw()},[t.noClear]);W(i,30);const u=s.useCallback(()=>{e.current&&(e.current.width=t.size?.x||e.current.clientWidth,e.current.height=t.size?.y||e.current.clientHeight)},[e,t.size]);return k("resize",u),{ref:e}},b=()=>{const r=s.useRef(null),t=s.useCallback(()=>{r.current?.play().catch(()=>{})},[r]);return k("click",t,{once:!0}),r};class H{siner;alpha;xstretch;ystretch;o_insurance;depth;b_insurance;OBSPEED;constructor(){this.siner=0,this.alpha=.2,this.xstretch=1,this.ystretch=1,this.o_insurance=0,this.depth=4,this.OBSPEED=.02,this.b_insurance=-.2}destroy(){}step(){this.siner+=1,this.OBSPEED>0&&(this.alpha=Math.sin(this.siner/34)*.2),this.ystretch+=this.OBSPEED,this.xstretch+=this.OBSPEED,this.b_insurance<0&&(this.b_insurance+=.01),this.ystretch>2&&(this.o_insurance+=.01,this.o_insurance>=.5&&this.destroy())}shouldDraw(){return this.siner<150&&this.siner>2}getAlpha(){return Math.max(0,.2+this.alpha-this.o_insurance+this.b_insurance)}}const z=()=>{E("ARE WE CONNECTED?");const r=s.useCallback(o=>{let n=[],i=new Image;i.src=G;let u=0,d=0,g=.5;return{update(){if(u+=1,d+=g,d>=20){let l=new H;l.depth=5+u,l.OBSPEED=.01*g,l.destroy=()=>n=n.filter(f=>f!==l),n.unshift(l),u>=6e4&&(u=0),d=0}for(let l of n)l.step()},draw(){if(i.complete)for(let l of n){if(!l.shouldDraw())continue;let f=l.getAlpha();o.globalAlpha=f;const c=i.width*l.xstretch,h=i.height*l.ystretch;o.drawImage(i,160-c/2,120-h/2,c,h)}}}},[]),{ref:t}=F(r,{size:x(320,240)}),e=b();return a.jsxs("div",{className:"pageBackground",children:[a.jsx("canvas",{className:"pageBackground",style:{objectFit:"cover",imageRendering:"crisp-edges"},ref:t}),a.jsx("audio",{src:L,ref:e,autoPlay:!0,loop:!0})]})},U="/assets/tree-DOnJeJ13.gif",_="/assets/man-DVTDGMKe.ogg",J=()=>{const r=b();return E("* "),a.jsxs("div",{className:"pageBackground",children:[a.jsx("div",{className:"fullscreen",style:{backgroundImage:`url("${U}")`,backgroundPosition:"center center",backgroundRepeat:"no-repeat"}}),a.jsx("audio",{src:_,loop:!0,autoPlay:!0,ref:r})]})},Z=()=>{const{myBurdenIsDead:r}=S(),[t]=s.useState(()=>[1,-1].map(e=>Array(128).fill(0).map((o,n)=>{const i=Math.floor(Math.random()*4)*5;return{key:e*(n+1),color:e>0?"#97257a":"#7463aa",size:i,top:Math.random()/2*100+(e==1?80:0)-20+"%",left:Math.random()*100+"%"}})).flat());return a.jsxs("div",{className:"pageBackground",style:{backgroundImage:"linear-gradient(#250630, #63173d)",height:"100vh"},children:[t.map(({key:e,size:o,color:n,top:i,left:u})=>a.jsx("div",{style:{backgroundColor:n,opacity:.7,width:o,height:o,position:"absolute",top:i,left:u}},e)),a.jsx("img",{src:"/assets/img/detail/oneshot/NikoPromoTransparent.png",style:{position:"absolute",bottom:"calc(-60px)",maxHeight:"200px",maxWidth:"70vw",marginLeft:"1rem"}}),a.jsx("div",{className:"pageBackground",style:{opacity:r?1:0,backgroundColor:"black",zIndex:2},children:a.jsx("img",{src:"/assets/img/detail/oneshot/NikoDead.png",style:{position:"absolute",bottom:"0px",maxHeight:"200px",maxWidth:"80vw",marginLeft:"1rem"}})})]})},w=x(320,180),Y=s.memo(()=>{const[r,t]=s.useState(!1);return s.useEffect(()=>{const e=requestAnimationFrame(()=>t(!0));return()=>cancelAnimationFrame(e)},[]),a.jsx("div",{className:"pageBackground",style:{backgroundImage:"url('/assets/img/detail/sky.png')",backgroundRepeat:"repeat",backgroundAttachment:"fixed"},children:r&&a.jsx(V,{})})}),V=()=>{const r=s.useRef(null),t=s.useRef(null);return s.useRef(null),s.useEffect(()=>{let e=!1;const o=requestAnimationFrame(()=>{if(e)return;const n=r.current;if(!n)return;n.width=n.clientWidth,n.height=n.clientHeight;const i=n.transferControlToOffscreen(),u=new Worker(new URL("/assets/effects.worker-Rp4pQ9-p.js",import.meta.url),{type:"module"});u.postMessage({type:"init",data:i},[i]),t.current=u});return()=>{cancelAnimationFrame(o),t.current?.terminate(),t.current=null,e=!0}},[]),k("resize",()=>{const e=r.current;e&&t.current?.postMessage({type:"dimensionsChange",data:x(e.clientWidth,e.clientHeight)})}),a.jsx("canvas",{ref:r,className:"pageBackground",style:{objectFit:"contain",aspectRatio:w.x/w.y,imageRendering:"pixelated"}})},X=()=>{const[{type:r}]=R();return a.jsxs("div",{style:{position:"fixed",zIndex:-1},children:[r==="starfield"&&a.jsx(Y,{},Date.now()),r==="oneshot"&&a.jsx(Z,{}),r==="depth"&&a.jsx(z,{}),r==="man"&&a.jsx(J,{})]})},q=s.createContext({ref:{current:null},analyser:{current:null},audioContext:{current:null},currentSong:null,loading:!0,playing:!1,changeCurrentSong:()=>{}}),K=[{title:"Fear of the Unknown",artist:"Lena Raine",cover:"celestefarewell.jpg",file:"Fear of the Unknown.mp3"},{title:"world.execute(me);",artist:"Mili",cover:"miraclemilk.jpg",file:"worldexecuteme.m4a"},{title:"Confessions of a Rotten Girl",artist:"SAWTOWNE",cover:"ConfessionsOfARottenGirl.png",file:"ConfessionsOfARottenGirl.mp3"},{title:"Medicine",romanji:"Igaku",artist:"Sasuke Haraguchi",originalTitle:"イガク",cover:"igaku.png",file:"igaku.mp3"},{title:"Flower of Transformation",romanji:"Bake no Hana",originalTitle:"化けの花",artist:"NAKISO",cover:"mizu5.png",file:"bakenohana.mp3"},{title:"Substitute",romanji:"Hitogawari",originalTitle:"ヒトガワリ",artist:"KikuoHana",file:"hitogawari.mp3",cover:"kikuohana2.png"},{title:"Take Me To The Beach (feat. Ado)",file:"TakeMeToTheBeach.mp3",cover:"TakeMeToTheBeach.png",artist:"Imagine Dragons"},{title:"A Fool Moon Night",artist:"THE KOXX",cover:"thekoxx.png",file:"afoolmoonnight.mp3"}],Q=({children:r})=>{const t=s.useRef(null),e=s.useRef(null),o=s.useRef(null),[n,i]=s.useState(null),[u,d]=s.useState(!1),[g,l]=s.useState(!1);s.useEffect(()=>{let c=new Audio;return t.current=c,()=>{e.current?.close(),c.pause(),c.remove(),t.current=null}},[]),s.useEffect(()=>{if(!t.current)return;const c=new AbortController,{signal:h}=c;return t.current.addEventListener("playing",()=>{m.hide("music-error")},{signal:h}),()=>c.abort()},[]),s.useEffect(()=>{if(!t.current)return;const c=new AbortController,{signal:h}=c;return t.current.addEventListener("ended",()=>{if(!n)return;const p=K;let C=p.indexOf(n);if(C==-1)return;let A=C+1;A>=p.length&&(A=0);let v=p[A];v&&i(v)},{signal:h}),()=>c.abort()},[n]),s.useEffect(()=>{if(n)return m.show({id:"music-nowplaying",title:a.jsx(y,{en:"Now Playing",tr:"Şimdi Çalıyor"}),message:n.title}),()=>void m.hide("music-nowplaying");m.hide("music-nowplaying")},[n]);const f=()=>{t.current?.play().then(()=>{e.current=new AudioContext;let c=e.current.createMediaElementSource(t.current);o.current=e.current.createAnalyser(),c.connect(o.current),c.connect(e.current.destination)}).catch(c=>{if(c instanceof DOMException&&c.name=="NotAllowedError"){m.show({id:"music-error",message:a.jsx(y,{en:"Can't play music, please click anywhere",tr:"Müzik çalınamıyor, herhangi bir yere tıklayın"}),autoClose:!1,position:"top-center",color:"yellow"});const h=()=>f();window.addEventListener("click",h,{once:!0})}})};return s.useEffect(()=>{t.current&&(t.current.pause(),t.current.src=n?`/assets/music/${n.file}`:"",n&&f())},[n]),a.jsx(q.Provider,{value:{ref:t,loading:u,playing:g,currentSong:n,analyser:o,audioContext:e,changeCurrentSong:i},children:r})},$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAALRJREFUOBHtk0sSgCAMQ8Hx/ldWBFNDqfxGdrrpN4/IqHOLHv/CPag/tWOJGAq+3mvumAJW0QLSOG7sOCxfzgrBpN3IBPgVquHsFDNEwELtNzS/jnsvsObUYixz/IPlupddBX166Qe5jhz9AhgS5LFkx2oubzWSCEMSUothSWjIqRJnJTuGJltAsxELTdEggBiW5B4qkSrTkuUYbFOAoX3GM+0Ra8NQV7XVIQghanivjhAfpSe9CxcmJTWuYwAAAABJRU5ErkJggg==",ee=()=>{const{ref:r}=s.useContext(B);return a.jsx("div",{className:"fullscreen",style:{zIndex:-1,position:"absolute",width:"100%",height:"100%",overflow:"visible"},children:a.jsx("div",{id:"SOUL",style:{width:22,height:22,backgroundImage:`url("${$}")`,transform:"translate(-100px, -100px)",transition:"transform 100ms"},ref:r})})},te=({providers:r,children:t})=>a.jsx(a.Fragment,{children:r.reduceRight((e,o)=>a.jsx(o,{children:e}),t)}),ie=j(function(){return a.jsxs(te,{providers:[M,O,P,D,T,Q,N],children:[a.jsx(X,{}),a.jsx(ee,{}),a.jsx(I,{})]})});export{ie as default};
