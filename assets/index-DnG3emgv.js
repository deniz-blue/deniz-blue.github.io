import{a as x,w as de}from"./chunk-C37GKA54-C1SU4sNO.js";import{j as l}from"./jsx-runtime-D_zvdyIk.js";import{a as ue,u as fe,d as pe,S as me,e as J,b as Q,f as he}from"./AppContext-CUrJxGGg.js";import{i as D,h as I,j as B,l as C,B as S,r as ge,n as M,w as ye,q as W,m as X,s as w,y as ee,I as te,u as ve,k as P,z as xe}from"./polymorphic-factory-BvxDOETY.js";import{S as $,T as se}from"./Stack-BM5NGK3T.js";import{p as z,U as je,T as U,L as be,O as Se,g as we,P as re}from"./Loader-B8X97TNR.js";import{a as H}from"./use-window-event-UTFVsWTy.js";import"./index-Dz_XntDv.js";function _e(t,s){return t in s?z(s[t]):z(t)}function Ie(t,s){const e=t.map(r=>({value:r,px:_e(r,s)}));return e.sort((r,o)=>r.px-o.px),e}function N(t){return typeof t=="object"&&t!==null?"base"in t?t.base:void 0:t}function Ne(t=[]){const[s,e]=x.useState(t);return[s,{setState:e,append:(...d)=>e(i=>[...i,...d]),prepend:(...d)=>e(i=>[...d,...i]),insert:(d,...i)=>e(f=>[...f.slice(0,d),...i,...f.slice(d)]),pop:()=>e(d=>{const i=[...d];return i.pop(),i}),shift:()=>e(d=>{const i=[...d];return i.shift(),i}),apply:d=>e(i=>i.map((f,p)=>d(f,p))),applyWhere:(d,i)=>e(f=>f.map((p,v)=>d(p,v)?i(p,v):p)),remove:(...d)=>e(i=>i.filter((f,p)=>!d.includes(p))),reorder:({from:d,to:i})=>e(f=>{const p=[...f],v=f[d];return p.splice(d,1),p.splice(i,0,v),p}),swap:({from:d,to:i})=>e(f=>{const p=[...f],v=p[d],G=p[i];return p.splice(i,1,v),p.splice(d,1,G),p}),setItem:(d,i)=>e(f=>{const p=[...f];return p[d]=i,p}),setItemProp:(d,i,f)=>e(p=>{const v=[...p];return v[d]={...v[d],[i]:f},v}),filter:d=>{e(i=>i.filter(d))}}]}var E={root:"m_8d3f4000",icon:"m_8d3afb97",loader:"m_302b9fb1",group:"m_1a0f1b21",groupSection:"m_437b6484"};const K={orientation:"horizontal"},Be=C((t,{borderWidth:s})=>({group:{"--ai-border-width":ge(s)}})),V=D((t,s)=>{const e=I("ActionIconGroup",K,t),{className:r,style:o,classNames:n,styles:a,unstyled:u,orientation:h,vars:m,borderWidth:c,variant:y,mod:_,attributes:g,...j}=I("ActionIconGroup",K,t),b=B({name:"ActionIconGroup",props:e,classes:E,className:r,style:o,classNames:n,styles:a,unstyled:u,attributes:g,vars:m,varsResolver:Be,rootSelector:"group"});return l.jsx(S,{...b("group"),ref:s,variant:y,mod:[{"data-orientation":h},_],role:"group",...j})});V.classes=E;V.displayName="@mantine/core/ActionIconGroup";const Ee=C((t,{radius:s,color:e,gradient:r,variant:o,autoContrast:n,size:a})=>{const u=t.variantColorResolver({color:e||t.primaryColor,theme:t,gradient:r,variant:o||"filled",autoContrast:n});return{groupSection:{"--section-height":W(a,"section-height"),"--section-padding-x":W(a,"section-padding-x"),"--section-fz":ye(a),"--section-radius":s===void 0?void 0:M(s),"--section-bg":e||o?u.background:void 0,"--section-color":u.color,"--section-bd":e||o?u.border:void 0}}}),L=D((t,s)=>{const e=I("ActionIconGroupSection",null,t),{className:r,style:o,classNames:n,styles:a,unstyled:u,vars:h,variant:m,gradient:c,radius:y,autoContrast:_,attributes:g,...j}=e,b=B({name:"ActionIconGroupSection",props:e,classes:E,className:r,style:o,classNames:n,styles:a,unstyled:u,attributes:g,vars:h,varsResolver:Ee,rootSelector:"groupSection"});return l.jsx(S,{...b("groupSection"),ref:s,variant:m,...j})});L.classes=E;L.displayName="@mantine/core/ActionIconGroupSection";const Ce=C((t,{size:s,radius:e,variant:r,gradient:o,color:n,autoContrast:a})=>{const u=t.variantColorResolver({color:n||t.primaryColor,theme:t,gradient:o,variant:r||"filled",autoContrast:a});return{root:{"--ai-size":W(s,"ai-size"),"--ai-radius":e===void 0?void 0:M(e),"--ai-bg":n||r?u.background:void 0,"--ai-hover":n||r?u.hover:void 0,"--ai-hover-color":n||r?u.hoverColor:void 0,"--ai-color":u.color,"--ai-bd":n||r?u.border:void 0}}}),A=X((t,s)=>{const e=I("ActionIcon",null,t),{className:r,unstyled:o,variant:n,classNames:a,styles:u,style:h,loading:m,loaderProps:c,size:y,color:_,radius:g,__staticSelector:j,gradient:b,vars:d,children:i,disabled:f,"data-disabled":p,autoContrast:v,mod:G,attributes:le,...ce}=e,O=B({name:["ActionIcon",j],props:e,className:r,style:h,classes:E,classNames:a,styles:u,unstyled:o,attributes:le,vars:d,varsResolver:Ce});return l.jsxs(je,{...O("root",{active:!f&&!m&&!p}),...ce,unstyled:o,variant:n,size:y,disabled:f||m,ref:s,mod:[{loading:m,disabled:f||p},G],children:[l.jsx(U,{mounted:!!m,transition:"slide-down",duration:150,children:ae=>l.jsx(S,{component:"span",...O("loader",{style:ae}),"aria-hidden":!0,children:l.jsx(be,{color:"var(--ai-color)",size:"calc(var(--ai-size) * 0.55)",...c})})}),l.jsx(S,{component:"span",mod:{loading:m},...O("icon"),children:i})]})});A.classes=E;A.displayName="@mantine/core/ActionIcon";A.Group=V;A.GroupSection=L;var oe={root:"m_7f854edf"};const Ae={position:{bottom:0,right:0},zIndex:we("modal"),withinPortal:!0},Re=C((t,{zIndex:s,position:e})=>({root:{"--affix-z-index":s?.toString(),"--affix-top":w(e?.top),"--affix-left":w(e?.left),"--affix-bottom":w(e?.bottom),"--affix-right":w(e?.right)}})),q=D((t,s)=>{const e=I("Affix",Ae,t),{classNames:r,className:o,style:n,styles:a,unstyled:u,vars:h,portalProps:m,zIndex:c,withinPortal:y,position:_,attributes:g,...j}=e,b=B({name:"Affix",classes:oe,props:e,className:o,style:n,classNames:r,styles:a,unstyled:u,attributes:g,vars:h,varsResolver:Re});return l.jsx(Se,{...m,withinPortal:y,children:l.jsx(S,{ref:s,...b("root"),...j})})});q.classes=oe;q.displayName="@mantine/core/Affix";var ne={root:"m_9e117634"};const Pe=C((t,{radius:s,fit:e})=>({root:{"--image-radius":s===void 0?void 0:M(s),"--image-object-fit":e}})),T=X((t,s)=>{const e=I("Image",null,t),{classNames:r,className:o,style:n,styles:a,unstyled:u,vars:h,onError:m,src:c,radius:y,fit:_,fallbackSrc:g,mod:j,attributes:b,...d}=e,[i,f]=x.useState(!c);x.useEffect(()=>f(!c),[c]);const p=B({name:"Image",classes:ne,props:e,className:o,style:n,classNames:r,styles:a,unstyled:u,attributes:b,vars:h,varsResolver:Pe});return i&&g?l.jsx(S,{component:"img",ref:s,src:g,...p("root"),onError:m,mod:["fallback",j],...d}):l.jsx(S,{component:"img",ref:s,...p("root"),src:c,onError:v=>{m?.(v),f(!0)},mod:j,...d})});T.classes=ne;T.displayName="@mantine/core/Image";function $e({spacing:t,verticalSpacing:s,cols:e,selector:r}){const o=ve(),n=s===void 0?t:s,a=ee({"--sg-spacing-x":w(N(t)),"--sg-spacing-y":w(N(n)),"--sg-cols":N(e)?.toString()}),u=P(o.breakpoints).reduce((c,y)=>(c[y]||(c[y]={}),typeof t=="object"&&t[y]!==void 0&&(c[y]["--sg-spacing-x"]=w(t[y])),typeof n=="object"&&n[y]!==void 0&&(c[y]["--sg-spacing-y"]=w(n[y])),typeof e=="object"&&e[y]!==void 0&&(c[y]["--sg-cols"]=e[y]),c),{}),m=Ie(P(u),o.breakpoints).filter(c=>P(u[c.value]).length>0).map(c=>({query:`(min-width: ${o.breakpoints[c.value]})`,styles:u[c.value]}));return l.jsx(te,{styles:a,media:m,selector:r})}function k(t){return typeof t=="object"&&t!==null?P(t):[]}function ze(t){return t.sort((s,e)=>z(s)-z(e))}function Te({spacing:t,verticalSpacing:s,cols:e}){const r=Array.from(new Set([...k(t),...k(s),...k(e)]));return ze(r)}function De({spacing:t,verticalSpacing:s,cols:e,selector:r}){const o=s===void 0?t:s,n=ee({"--sg-spacing-x":w(N(t)),"--sg-spacing-y":w(N(o)),"--sg-cols":N(e)?.toString()}),a=Te({spacing:t,verticalSpacing:s,cols:e}),u=a.reduce((m,c)=>(m[c]||(m[c]={}),typeof t=="object"&&t[c]!==void 0&&(m[c]["--sg-spacing-x"]=w(t[c])),typeof o=="object"&&o[c]!==void 0&&(m[c]["--sg-spacing-y"]=w(o[c])),typeof e=="object"&&e[c]!==void 0&&(m[c]["--sg-cols"]=e[c]),m),{}),h=a.map(m=>({query:`simple-grid (min-width: ${m})`,styles:u[m]}));return l.jsx(te,{styles:n,container:h,selector:r})}var ie={container:"m_925c2d2c",root:"m_2415a157"};const Ge={cols:1,spacing:"md",type:"media"},Y=D((t,s)=>{const e=I("SimpleGrid",Ge,t),{classNames:r,className:o,style:n,styles:a,unstyled:u,vars:h,cols:m,verticalSpacing:c,spacing:y,type:_,attributes:g,...j}=e,b=B({name:"SimpleGrid",classes:ie,props:e,className:o,style:n,classNames:r,styles:a,unstyled:u,attributes:g,vars:h}),d=xe();return _==="container"?l.jsxs(l.Fragment,{children:[l.jsx(De,{...e,selector:`.${d}`}),l.jsx("div",{...b("container"),children:l.jsx(S,{ref:s,...b("root",{className:d}),...j})})]}):l.jsxs(l.Fragment,{children:[l.jsx($e,{...e,selector:`.${d}`}),l.jsx(S,{ref:s,...b("root",{className:d}),...j})]})});Y.classes=ie;Y.displayName="@mantine/core/SimpleGrid";const Oe=()=>{const{disable:t,myBurdenIsDead:s,enable:e,toggle:r}=ue();return fe(s?"[You killed Niko]":"deniz.blue ðŸ’¡"),pe([["r",()=>t("myBurdenIsDead")]]),l.jsx(S,{children:l.jsxs($,{w:"100%",align:"center",justify:"center",h:"100dvh",gap:4,children:[l.jsx(re,{className:"frost",p:4,children:l.jsxs(se,{fz:"xs",c:s?"dimmed":"white",children:["My Burden is ",s?"Dead":"Light"]})}),l.jsx(U,{mounted:s,keepMounted:!0,children:o=>l.jsx(T,{style:{userSelect:"none",...o},draggable:!1,src:"/assets/img/detail/oneshot/SunBroken.png",title:"[You broke it.]",w:32,h:32})}),!s&&l.jsx(A,{variant:"subtle",color:"black",onClick:()=>r("myBurdenIsDead"),size:32,children:l.jsx(T,{src:"/assets/img/detail/oneshot/item_start_lightbulb.png",title:"[Be careful.]",w:32,h:32})})]})})},ke=({children:t,disabled:s})=>{const e=x.useRef(null),{selectables:r,setSelected:o}=x.useContext(me);return x.useEffect(()=>{if(s)r.delete(e);else return r.add(e),()=>void r.delete(e)},[e,s]),x.useEffect(()=>{if(!e.current)return;const n=e.current,a=new AbortController,u=a.signal;return n.addEventListener("mouseenter",()=>o(e),{signal:u}),()=>a.abort()},[e]),l.jsx("div",{ref:e,children:t})},Fe=()=>l.jsx($,{m:"xl",align:"center",children:l.jsx(Y,{cols:3,spacing:"xl",children:["DARK","DARKER","YET DARKER","SOUL","SUN","STRAWBERRY"].map((t,s)=>l.jsx(ke,{children:l.jsx(re,{style:{cursor:"pointer"},children:l.jsx(se,{ta:"center",inline:!0,span:!0,ff:"monospace",c:"white",children:t})})},s))})}),We=({disabled:t,inputRef:s,onKeyDown:e,setValue:r,value:o})=>{const n=x.useCallback(()=>{s.current&&!t&&document.getSelection()?.isCollapsed&&s.current!==document.activeElement&&(s.current.focus(),s.current.setSelectionRange(s.current.value.length,s.current.value.length))},[t]);return H("mouseup",n),H("touchend",n),x.useLayoutEffect(()=>{s.current&&(s.current.style.width=(o.length+1)*10.7+"px")},[o]),l.jsx("input",{ref:s,className:"terminal-input",onKeyDown:e,value:t?"":o,onChange:a=>{r(a.currentTarget.value)},disabled:t,autoCapitalize:"none",autoComplete:"off",spellCheck:"false",autoFocus:!0})},Me={Black:"#000000",Blue:"#2472c8",BrightBlack:"#666666",BrightBlue:"#3b8eea",BrightCyan:"#29b8db",BrightGreen:"#23d18b",BrightMagenta:"#d670d6",BrightRed:"#f14c4c",BrightWhite:"#e5e5e5",BrightYellow:"#f5f543",Cyan:"#11a8cd",Green:"#0dbc79",Magenta:"#bc3fbc",Red:"#cd3131",White:"#e5e5e5",Yellow:"#e5e510",selection:"#264f78"},Z=t=>t&&(Me[t]??t),Ue=({buffer:t,onClick:s})=>l.jsx(S,{component:"pre",className:"terminal-content",children:t.map((e,r)=>{const o={color:Z(e.fg),backgroundColor:Z(e.bg),fontWeight:e.b?"bold":"normal"};let n;return e.filepath&&(n=()=>s?.(e)),n?l.jsx("a",{onClick:n,style:o,children:e.text}):l.jsx("span",{style:o,children:e.text})})}),Ve=t=>typeof t=="string"?{text:t}:t;function Le(t){const s=t.fs.getNode(t.args[0]);if(!s)throw new Error(`cat: ${t.args[0]}: No such file or directory`);if(s.type=="dir")throw new Error(`cat: ${t.args[0]}: Is a directory`);t.stdout(s.content||"")}const qe=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));function Ye(t){let s=t.fs.resolve((t.args[0][0]=="/"?"":t.cwd+"/")+t.args[0]);if(!t.fs.exists(s))throw new Error(`shell: cd: ${s}: No such file or directory`);t.cd(s)}const He=Object.freeze(Object.defineProperty({__proto__:null,default:Ye},Symbol.toStringTag,{value:"Module"}));function Ke(t){t.stdout(t.args.join(" "))}const Ze=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"}));function Je(t){let s=t.cwd+"/"+(t.args[0]||""),e=t.fs.getNode(s);if(!e)throw new Error(`ls: cannot access '${s}': No such file or directory`);for(let r of e.children||[])t.stdout({text:r.name,fg:r.type=="dir"?"Blue":void 0,b:r.type=="dir",filepath:t.fs.resolve(s+"/"+r.name)}),t.stdout(" ")}const Qe=Object.freeze(Object.defineProperty({__proto__:null,default:Je},Symbol.toStringTag,{value:"Module"})),Xe=Object.fromEntries(Object.entries(Object.assign({"./programs/cat.ts":qe,"./programs/cd.ts":He,"./programs/echo.ts":Ze,"./programs/ls.ts":Qe})).map(([t,s])=>{let e=t.split("/");return[e[e.length-1].split(".")[0],s.default]}));class et{root;constructor(s){this.root=s}normalize(s){return s.split("/").filter(Boolean).reduce((e,r)=>(r==="."||(r===".."?e.pop():e.push(r)),e),[])}resolve(s){return["",...this.normalize(s)].join("/")}getNode(s){const e=this.normalize(s);let r=this.root;for(const o of e){if(r.type!=="dir"||!r.children)return null;const n=r.children.find(a=>a.name===o);if(!n)return null;r=n}return r}exists(s){return this.getNode(s)!==null}read(s){const e=this.getNode(s);if(!e||e.type!=="file")throw new Error(`File not found: ${s}`);return e.content??""}write(s,e){const r=this.normalize(s),o=r.pop();if(!o)throw new Error("Invalid path");let n=this.getNode("/"+r.join("/"));if(!n||n.type!=="dir")throw new Error("Directory not found");const a=n.children?.find(h=>h.name===o);if(a&&a.type!=="file")throw new Error(`Cannot overwrite directory: ${o}`);n.children||(n.children=[]);const u={name:o,type:"file",content:e};a?Object.assign(a,u):n.children.push(u)}mkdir(s){const e=this.normalize(s),r=e.pop();if(!r)throw new Error("Invalid path");const o=this.getNode("/"+e.join("/"));if(!o||o.type!=="dir")throw new Error("Parent directory does not exist");if(o.children||(o.children=[]),o.children.find(n=>n.name===r))throw new Error("Directory or file already exists");o.children.push({name:r,type:"dir",children:[]})}rm(s){const e=this.normalize(s),r=e.pop();if(!r)throw new Error("Invalid path");const o=this.getNode("/"+e.join("/"));if(!o||o.type!=="dir"||!o.children)throw new Error("Parent directory not found");const n=o.children.findIndex(a=>a.name===r);if(n===-1)throw new Error("Target not found");o.children.splice(n,1)}}const F=(t,s)=>({name:t,type:"file",content:s}),R=(t,s)=>({name:t,type:"dir",children:s}),tt=R("/",[R("home",[R("user",[F("DEVICE.bin",""),F("NOTE.txt","this section is still a WIP"),R("stuff",[F("girl","mrrp :3")])])])]),st=({onSubmit:t})=>{const s=x.useRef(null),[e,r]=x.useState(""),[o,n]=Ne(),a=x.useRef(null);return{inputRef:s,onKeyDown:h=>{if(h.key=="Enter")h.preventDefault(),t?.(e),o[o.length-1]!==e&&n.append(e),a.current=null,r("");else if(h.key=="ArrowUp"||h.key=="ArrowDown"){h.preventDefault();let m=a.current,c=h.key=="ArrowUp"?m==null?o.length-1:m-1:m==null?null:m+1;c!==null&&c<0&&(c=0),c!==null&&c>=o.length&&(c=null),r(c===null?"":o[c]),a.current=c}},value:e,setValue:r}},rt=t=>{const s=x.useRef(null);return x.useEffect(()=>{s.current?.scrollTo({top:s.current.scrollHeight})},[s,...t]),s},ot=()=>{const[t,s]=J(),[e,r]=Q(),o={"/home/user/DEVICE.bin":()=>{r({type:"depth"}),s({showTerminal:!1,showDevice:!0})}},n=x.useRef("user"),a=x.useRef("/home/user"),u=new et(tt),h=i=>i.startsWith("/")?u.resolve(i):u.resolve(a.current+"/"+i),m=()=>[{text:`${n.current}@lab02`,fg:"Green",b:!0},{text:":",b:!0},{text:a.current,fg:"Blue",b:!0},{text:"$ ",b:!0}],[c,y]=x.useState([...m()]),_=rt([c]),g=i=>{let f=Array.isArray(i)?i:[i];y(p=>[...p,...f.map(Ve)])},j=async(i,f)=>{const p=Xe[i];if(p)try{await p({cwd:a.current,fs:u,args:f,username:n.current,cd:v=>a.current=v,setUsername:v=>n.current=v,stdout:g,stdin:""})}catch(v){g({text:""+v.message,fg:"BrightRed"})}else g(`shell: ${i} not found`)},d=st({onSubmit:async i=>{if(g(i),g(`
`),i&&(i.startsWith("./")||i.startsWith("/"))){const f=h(i);if(g(f+`
`),o[f])o[f]();else{let p=u.getNode(f);g(p?`shell: ${i}: ${p.type=="file"?"Permission denied":"Is a directory"}`:`shell: ${i}: No such file or directory`)}g(`
`)}else if(i){const[f,...p]=i.split(" ");await j(f,p),g(`
`)}g(m())}});return l.jsxs(S,{className:"fullscreen terminal",style:{lineHeight:1,display:"inline-block"},ref:_,children:[l.jsx(Ue,{buffer:c,onClick:i=>{if(i.filepath){let f=u.getNode(i.filepath);if(!f)return;d.setValue(`${f.type=="dir"?"cd":f.name.endsWith(".bin")?"":"cat"} ${i.filepath}`.trim())}}}),l.jsx(We,{...d})]})},mt=de(function(){const[{type:s}]=Q(),[e]=J();return l.jsxs(S,{children:[s=="oneshot"&&l.jsx(Oe,{}),e.showDevice&&l.jsx(Fe,{}),e.showTerminal&&l.jsx(ot,{}),l.jsx(nt,{})]})}),nt=()=>{const{toggle:t,musicPopout:s}=he(),e=!s;return l.jsx(q,{position:{bottom:5,right:5},children:l.jsx(U,{mounted:e,transition:"fade-up",keepMounted:!0,children:r=>l.jsx($,{gap:0,style:r,children:l.jsx($,{gap:5,align:"end"})})})})};export{mt as default};
