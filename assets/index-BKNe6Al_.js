var j=Object.defineProperty;var C=(r,t,e)=>t in r?j(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var p=(r,t,e)=>C(r,typeof t!="symbol"?t+"":t,e);import{r as i,w as A,O as B}from"./chunk-EF7DTUVF-pxdf6ITT.js";import{j as a}from"./jsx-runtime-BjG_zV1W.js";import{u as T,a as D,b as O,L as E,M,B as I,F as P,U as S}from"./MusicPlayerContext-CiBA0Q02.js";import{u as b}from"./use-window-event-CzxwU0aH.js";import"./LanguageContext-DM0QwpTO.js";import{a as k}from"./notifications.store-8uNrJnAf.js";import"./use-isomorphic-effect-BNO9nc8e.js";const R="/assets/IMAGE_DEPTH-y3CnTVpV.png",_="/assets/AUDIO_ANOTHERHIM-D8FEBsaZ.ogg",v=(r,t)=>{i.useEffect(()=>{const e=setInterval(r,t);return()=>clearInterval(e)},[r,t])},N=(r,t={})=>{const e=i.useRef(null),c=i.useRef(null);i.useEffect(()=>{var n;const o=e.current;if(!o)return;o.width=o.clientWidth,o.height=o.clientHeight;const f=o.getContext("2d",{alpha:!0,desynchronized:!0});return f?(c.current=r(f),()=>{var u,l;(l=(u=c.current)==null?void 0:u.destroy)==null||l.call(u)}):(n=t==null?void 0:t.onFail)==null?void 0:n.call(t)},[e]);const s=i.useCallback(()=>{var o;(o=c.current)==null||o.draw()},[]),d=i.useCallback(()=>{var o,f;(f=(o=c.current)==null?void 0:o.update)==null||f.call(o,1)},[]);v(s,24),v(d,24);const g=i.useCallback(()=>{!e.current||t.handleResize===!1||(e.current.width=e.current.clientWidth,e.current.height=e.current.clientHeight)},[e,t.handleResize]);return b("resize",g),{ref:e}},H=()=>{const r=i.useRef(null),t=i.useCallback(()=>{var e;(e=r.current)==null||e.play().catch(()=>{})},[r]);return b("click",t,{once:!0}),r};class F{constructor(){p(this,"siner");p(this,"alpha");p(this,"xstretch");p(this,"ystretch");p(this,"o_insurance");p(this,"depth");p(this,"b_insurance");p(this,"OBSPEED");this.siner=0,this.alpha=.2,this.xstretch=1,this.ystretch=1,this.o_insurance=0,this.depth=4,this.OBSPEED=.02,this.b_insurance=-.2}destroy(){}step(){this.siner+=1,this.OBSPEED>0&&(this.alpha=Math.sin(this.siner/34)*.2),this.ystretch+=this.OBSPEED,this.xstretch+=this.OBSPEED,this.b_insurance<0&&(this.b_insurance+=.01),this.ystretch>2&&(this.o_insurance+=.01,this.o_insurance>=.5&&this.destroy())}draw(){this.siner>2}shouldDraw(){return this.siner>2}getAlpha(){return .2+this.alpha-this.o_insurance+this.b_insurance}}const L=()=>{T("ARE WE CONNECTED?");const{ref:r}=N(e=>{e.canvas.width=640,e.canvas.height=480;let c=new Set,s=new Image;s.src=R;let d=0,g=0,o=.5;const f=(n,u,l)=>{const h=s.width,m=s.height,y=e.canvas.width/2,x=e.canvas.height/2;e.save(),e.globalAlpha=l,e.translate(y,x),e.scale(n,u),e.drawImage(s,-h/2,-m/2),e.restore()};return{update(){if(d+=1,g+=o,g>=20){let n=new F;n.depth=5+d,n.OBSPEED=.01*o,n.destroy=()=>c.delete(n),c.add(n),d>=6e4&&(d=0),g=0}for(let n of c)n.step()},draw(){if(s.complete)for(let n of c){if(!n.shouldDraw())continue;let u=n.getAlpha();f(1+n.xstretch,1+n.ystretch,u),f(-1-n.xstretch,1+n.ystretch,u),f(-1-n.xstretch,-1-n.ystretch,u),f(1+n.xstretch,-1-n.ystretch,u)}}}},{handleResize:!1}),t=H();return a.jsxs("div",{className:"pageBackground",children:[a.jsx("canvas",{className:"pageBackground",style:{objectFit:"cover"},ref:r}),a.jsx("audio",{src:_,ref:t,autoPlay:!0,loop:!0})]})},z="/assets/tree-DOnJeJ13.gif",U=()=>a.jsx("div",{className:"pageBackground",children:a.jsx("div",{className:"fullscreen",style:{backgroundImage:`url("${z}")`,backgroundPosition:"center center",backgroundRepeat:"no-repeat"}})}),W=()=>{const{myBurdenIsDead:r}=D(),[t]=i.useState(()=>[1,-1].map(e=>Array(128).fill(0).map((c,s)=>{const d=Math.floor(Math.random()*4)*5;return{key:e*(s+1),color:e>0?"#97257a":"#7463aa",size:d,top:Math.random()/2*100+(e==1?80:0)-20+"%",left:Math.random()*100+"%"}})).flat());return a.jsxs("div",{className:"pageBackground",style:{backgroundImage:"linear-gradient(#250630, #63173d)",height:"100vh"},children:[t.map(({key:e,size:c,color:s,top:d,left:g})=>a.jsx("div",{style:{backgroundColor:s,opacity:.7,width:c,height:c,position:"absolute",top:d,left:g}},e)),a.jsx("img",{src:"/assets/img/detail/oneshot/NikoPromoTransparent.png",style:{position:"absolute",bottom:"calc(-60px)",maxHeight:"200px",maxWidth:"70vw",marginLeft:"1rem"}}),a.jsx("div",{className:"pageBackground",style:{opacity:r?1:0,backgroundColor:"black",zIndex:2},children:a.jsx("img",{src:"/assets/img/detail/oneshot/NikoDead.png",style:{position:"absolute",bottom:"0px",maxHeight:"200px",maxWidth:"80vw",marginLeft:"1rem"}})})]})},G=()=>{const[{type:r}]=O();return a.jsxs("div",{children:[r==="oneshot"&&a.jsx(W,{}),r==="depth"&&a.jsx(L,{}),r==="man"&&a.jsx(U,{})]})},V=[{title:"Fear of the Unknown",artist:"Lena Raine",cover:"celestefarewell.jpg",file:"Fear of the Unknown.mp3"},{title:"world.execute(me);",artist:"Mili",cover:"miraclemilk.jpg",file:"worldexecuteme.m4a"},{title:"Confessions of a Rotten Girl",artist:"SAWTOWNE",cover:"ConfessionsOfARottenGirl.png",file:"ConfessionsOfARottenGirl.mp3"},{title:"Medicine",romanji:"Igaku",artist:"Sasuke Haraguchi",originalTitle:"イガク",cover:"igaku.png",file:"igaku.mp3"},{title:"Flower of Transformation",romanji:"Bake no Hana",originalTitle:"化けの花",artist:"NAKISO",cover:"mizu5.png",file:"bakenohana.mp3"},{title:"Substitute",romanji:"Hitogawari",originalTitle:"ヒトガワリ",artist:"KikuoHana",file:"hitogawari.mp3",cover:"kikuohana2.png"},{title:"Take Me To The Beach (feat. Ado)",file:"TakeMeToTheBeach.mp3",cover:"TakeMeToTheBeach.png",artist:"Imagine Dragons"},{title:"A Fool Moon Night",artist:"THE KOXX",cover:"thekoxx.png",file:"afoolmoonnight.mp3"}],K=({children:r})=>{const t=i.useRef(null),e=i.useRef(null),c=i.useRef(null),[s,d]=i.useState(null),[g,o]=i.useState(!1),[f,n]=i.useState(!1);i.useEffect(()=>{let l=new Audio;return t.current=l,()=>{var h;(h=e.current)==null||h.close(),l.pause(),l.remove(),t.current=null}},[]),i.useEffect(()=>{if(!t.current)return;const l=new AbortController,{signal:h}=l;return t.current.addEventListener("playing",()=>{k.hide("music-error")},{signal:h}),()=>l.abort()},[]),i.useEffect(()=>{if(!t.current)return;const l=new AbortController,{signal:h}=l;return t.current.addEventListener("ended",()=>{if(!s)return;const m=V;let y=m.indexOf(s);if(y==-1)return;let x=y+1;x>=m.length&&(x=0);let w=m[x];w&&d(w)},{signal:h}),()=>l.abort()},[s]),i.useEffect(()=>{if(s)return k.show({id:"music-nowplaying",title:a.jsx(E,{en:"Now Playing",tr:"Şimdi Çalıyor"}),message:s.title}),()=>void k.hide("music-nowplaying");k.hide("music-nowplaying")},[s]);const u=()=>{var l;(l=t.current)==null||l.play().then(()=>{e.current=new AudioContext;let h=e.current.createMediaElementSource(t.current);c.current=e.current.createAnalyser(),h.connect(c.current),h.connect(e.current.destination)}).catch(h=>{if(h instanceof DOMException&&h.name=="NotAllowedError"){k.show({id:"music-error",message:a.jsx(E,{en:"Can't play music, please click anywhere",tr:"Müzik çalınamıyor, herhangi bir yere tıklayın"}),autoClose:!1,position:"top-center",color:"yellow"});const m=()=>u();window.addEventListener("click",m,{once:!0})}})};return i.useEffect(()=>{t.current&&(t.current.pause(),t.current.src=s?`/assets/music/${s.file}`:"",s&&u())},[s]),a.jsx(M.Provider,{value:{ref:t,loading:g,playing:f,currentSong:s,analyser:c,audioContext:e,changeCurrentSong:d},children:r})},te=A(function(){return a.jsx(I,{children:a.jsx(P,{children:a.jsx(S,{children:a.jsxs(K,{children:[a.jsx(G,{}),a.jsx(B,{})]})})})})});export{te as default};
