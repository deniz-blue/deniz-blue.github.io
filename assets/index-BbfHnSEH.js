import{a as d,p as u,w as I,q as E,O as R}from"./chunk-4WY6JWTD-DausnuBa.js";import{L as v,c as G,v as b,a as j,u as x,b as O,W as L,F as D,A as T,P as B}from"./useSoundEffect-DWZ434VF.js";import{U as N}from"./UIContext-Cnb_0Nbg.js";import{u as M,C as P,L as U}from"./LanguageContext-Ff99D7wO.js";import{a as y}from"./notifications.store-lTq-jTht.js";import"./use-isomorphic-effect-DaP3eo3O.js";import"./factory-Chu4lyg_.js";import"./polymorphic-factory-A8nCz7JD.js";const W=d.createContext({ref:{current:null},analyser:{current:null},audioContext:{current:null},currentSong:null,loading:!0,playing:!1,changeCurrentSong:()=>{}}),H=[{title:"Fear of the Unknown",artist:"Lena Raine",cover:"celestefarewell.jpg",file:"Fear of the Unknown.mp3"},{title:"world.execute(me);",artist:"Mili",cover:"miraclemilk.jpg",file:"worldexecuteme.m4a"},{title:"Confessions of a Rotten Girl",artist:"SAWTOWNE",cover:"ConfessionsOfARottenGirl.png",file:"ConfessionsOfARottenGirl.mp3"},{title:"Medicine",romanji:"Igaku",artist:"Sasuke Haraguchi",originalTitle:"イガク",cover:"igaku.png",file:"igaku.mp3"},{title:"Flower of Transformation",romanji:"Bake no Hana",originalTitle:"化けの花",artist:"NAKISO",cover:"mizu5.png",file:"bakenohana.mp3"},{title:"Substitute",romanji:"Hitogawari",originalTitle:"ヒトガワリ",artist:"KikuoHana",file:"hitogawari.mp3",cover:"kikuohana2.png"},{title:"Take Me To The Beach (feat. Ado)",file:"TakeMeToTheBeach.mp3",cover:"TakeMeToTheBeach.png",artist:"Imagine Dragons"},{title:"A Fool Moon Night",artist:"THE KOXX",cover:"thekoxx.png",file:"afoolmoonnight.mp3"}],F=({children:o})=>{const n=d.useRef(null),t=d.useRef(null),i=d.useRef(null),[r,c]=d.useState(null),[l,s]=d.useState(!1),[g,f]=d.useState(!1);d.useEffect(()=>{let e=new Audio;return n.current=e,()=>{t.current?.close(),e.pause(),e.remove(),n.current=null}},[]),d.useEffect(()=>{if(!n.current)return;const e=new AbortController,{signal:a}=e;return n.current.addEventListener("playing",()=>{y.hide("music-error")},{signal:a}),()=>e.abort()},[]),d.useEffect(()=>{if(!n.current)return;const e=new AbortController,{signal:a}=e;return n.current.addEventListener("ended",()=>{if(!r)return;const m=H;let A=m.indexOf(r);if(A==-1)return;let p=A+1;p>=m.length&&(p=0);let h=m[p];h&&c(h)},{signal:a}),()=>e.abort()},[r]),d.useEffect(()=>{if(r)return y.show({id:"music-nowplaying",title:u.jsx(v,{en:"Now Playing",tr:"Şimdi Çalıyor"}),message:r.title}),()=>void y.hide("music-nowplaying");y.hide("music-nowplaying")},[r]);const w=()=>{n.current?.play().then(()=>{t.current=new AudioContext;let e=t.current.createMediaElementSource(n.current);i.current=t.current.createAnalyser(),e.connect(i.current),e.connect(t.current.destination)}).catch(e=>{if(e instanceof DOMException&&e.name=="NotAllowedError"){y.show({id:"music-error",message:u.jsx(v,{en:"Can't play music, please click anywhere",tr:"Müzik çalınamıyor, herhangi bir yere tıklayın"}),autoClose:!1,position:"top-center",color:"yellow"});const a=()=>w();window.addEventListener("click",a,{once:!0})}})};return d.useEffect(()=>{n.current&&(n.current.pause(),n.current.src=r?`/assets/music/${r.file}`:"",r&&w())},[r]),u.jsx(W.Provider,{value:{ref:n,loading:l,playing:g,currentSong:r,analyser:i,audioContext:t,changeCurrentSong:c},children:o})},X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAALRJREFUOBHtk0sSgCAMQ8Hx/ldWBFNDqfxGdrrpN4/IqHOLHv/CPag/tWOJGAq+3mvumAJW0QLSOG7sOCxfzgrBpN3IBPgVquHsFDNEwELtNzS/jnsvsObUYixz/IPlupddBX166Qe5jhz9AhgS5LFkx2oubzWSCEMSUothSWjIqRJnJTuGJltAsxELTdEggBiW5B4qkSrTkuUYbFOAoX3GM+0Ra8NQV7XVIQghanivjhAfpSe9CxcmJTWuYwAAAABJRU5ErkJggg==",Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAAAAAAAAPlDu38AAAAHdElNRQfpCAoOASJktxbgAAAA6UlEQVQ4y9WTIQ7CQBBFXwmqWGpBo6u5CdwBzQHQWDTcBF2NBguWWjAz4bMM7Ur4yaZN+/flZaeFX0/hN4/XszUwAu7ARks5nRS4AuZSPgLbRCLsOGgoxQUwA2optwbYCqxOOjfbe0iBEwNWQGmrTuwcpp0ZcPaCAqdSwq6VAXYCrJJOaXs/gFEUSgILkwMsgTGZGeQWc6OGZzkPPctvaW2dkKGo4cVeXq3Yl9a6J9sLxH/KntcgIlM3awy4VFA0lMaAE+KpupkD31KkDzpMHRaaRUPpM6XL7Kthh6kDl10b+z5sNXXgn+cJ6No9ST9X3LMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjUtMDgtMTBUMTQ6MDE6MzQrMDA6MDABpoTaAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDI1LTA4LTEwVDE0OjAxOjM0KzAwOjAwcPs8ZgAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyNS0wOC0xMFQxNDowMTozNCswMDowMCfuHbkAAAAASUVORK5CYII=",k=G()((o,n)=>({ref:{current:null}})),Z=()=>{const{ref:o}=k();return u.jsxs("div",{id:"SOUL",ref:o,children:[u.jsx("div",{className:"soul heart",style:{backgroundImage:`url("${X}")`}}),u.jsx("div",{className:"soul blur",style:{backgroundImage:`url("${Y}")`}})]})},J=({providers:o,children:n})=>u.jsx(u.Fragment,{children:o.reduceRight((t,i)=>u.jsx(i,{children:t}),n)}),S=(o,{pos:n,zIndex:t,opacity:i,blur:r})=>{n&&(o.style.transform=`translate(${n.x-11}px, ${n.y-11+window.scrollY}px)`),t!==void 0&&(o.style.zIndex=t?t.toString():""),i!==void 0&&(o.style.opacity=i.toString()),o.style.setProperty("--blur",r?"1":"0")},z=o=>{const n=o.getBoundingClientRect(),t=32,i=window.innerWidth,r=window.innerHeight;let c=0,l=0;n.left<t?c=n.left-t:n.right>i-t&&(c=n.right-(i-t)),n.top<t?l=n.top-t:n.bottom>r-t&&(l=n.bottom-(r-t)),(c!==0||l!==0)&&window.scrollBy({left:c,top:l,behavior:"smooth"})},Q=o=>{let n=o.getAttribute("data-soul-anchor")||"center",t=o.getBoundingClientRect(),i=!!o.getAttribute("data-soul-blur");const r=(p,h)=>{let C=o.getAttribute(p);return C!==null&&!isNaN(Number(C))?Number(C):h};let c=r("data-soul-z",0);const l=4;let s=r("data-soul-mt",l),g=r("data-soul-mb",l),f=r("data-soul-ml",l),w=r("data-soul-mr",l),e="center",a="center";if(n!="center"){if(n?.includes("-")){let[p,h]=n.split("-");e=p.replace("left","start").replace("right","end"),a=h.replace("top","start").replace("bottom","end")}}let m;if(e=="center")m=t.x+t.width/2+w-f;else if(e=="start")m=t.x-f;else if(e=="end")m=t.x+t.width+w;else throw new Error("Invalid state");let A;if(a=="center")A=t.y+t.height/2+s-g;else if(a=="start")A=t.y-s;else if(a=="end")A=t.y+t.height+g;else throw new Error("Invalid state");return{pos:b(m,A),zIndex:c,blur:i}};function V(o,n,t){const i=o?.getBoundingClientRect(),r=i?b(i.left+i.width/2,i.top+i.height/2):b();let c=n.map(e=>{if(e==o)return null;const a=e.getBoundingClientRect(),m=b(a.left+a.width/2,a.top+a.height/2),A=j(m,r),p=Math.hypot(A.x,A.y);let h=Math.atan2(A.y,A.x);const C=["right","down","left","up"][Math.round((h+Math.PI*2)%(Math.PI*2)/(Math.PI/2))%4];return{node:e,delta:A,dist:p,angle:h,direction:C}}).filter(e=>e!==null).sort((e,a)=>e.dist-a.dist);const l=c.filter(e=>{if(t=="down")return e.delta.y>0;if(t=="up")return e.delta.y<0;if(t=="left")return e.delta.x<0;if(t=="right")return e.delta.x>0}),s=l.find(e=>e.direction=="up"||e.direction=="down"?e.delta.x==0:e.delta.y==0);if(s&&c.indexOf(s)<4)return s.node;const g=5,f=l.find(e=>(e.direction=="up"||e.direction=="down"?e.delta.x:e.delta.y)-g/2<g*2);return f?f.node:l[0]?.node??null}const K="/assets/OneShotMenuCursor-BmwqYD4l.wav",q="/assets/OneShotMenuDecision-CtfpWGTn.wav",$="/assets/OneShotMenuCancel-BbAlDvoI.wav",_=()=>{const{ref:o}=k(),{play:n}=x(K),{play:t}=x(q),{play:i}=x($),r=d.useRef(null),c=()=>{if(!document.activeElement?.classList.contains("soulSelectable"))return;let s=r.current,g=s!==document.activeElement;if(r.current=document.activeElement??null,g&&s?.removeAttribute("data-soul-selected"),r.current?.setAttribute("data-soul-selected","true"),!!o.current)if(r.current){g&&n(),r.current.focus();const{...f}=Q(r.current);S(o.current,{opacity:1,...f})}else S(o.current,{pos:b(),opacity:0})},l=s=>{const g=[...document.querySelectorAll(".soulSelectable")],f=V(r.current,g,s);f&&(z(f),f.focus(),c())};return O([["ArrowUp",()=>l("up")],["w",()=>l("up")],["ArrowDown",()=>l("down")],["s",()=>l("down")],["ArrowLeft",()=>l("left")],["a",()=>l("left")],["ArrowRight",()=>l("right")],["d",()=>l("right")],["Enter",()=>{let s=r.current;s&&(console.log(s),s.dataset.active?i():t(),s.click())}]]),M("keydown",()=>{setTimeout(c,0)}),M("keyup",()=>{setTimeout(c,0)}),null},ae=I(function(){return u.jsxs(J,{providers:[L,D,T,N,F],children:[u.jsx(B,{}),u.jsx(Z,{}),u.jsx(_,{}),u.jsx(R,{})]})}),ce=E(function(){return u.jsx(P,{my:"xl",h:"90vh",children:u.jsx(U,{})})});export{ce as HydrateFallback,ae as default};
